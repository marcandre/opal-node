// Generated by CoffeeScript 1.6.3
(function() {
  var extension, extensions, fs, parser, parserFile, source, sourceFile, vm, _i, _len;

  sourceFile = "" + __dirname + "/../opal/opal.js";

  parserFile = "" + __dirname + "/../opal/opal-parser.js";

  extensions = ['.opal', '.rb'];

  fs = require('fs');

  source = fs.readFileSync(sourceFile).toString();

  parser = fs.readFileSync(parserFile).toString();

  vm = require('vm');

  vm.runInThisContext(source, sourceFile);

  vm.runInThisContext(parser, parserFile);

  Opal.compile = function(ruby, options) {
    var key, keys, value;
    if (options == null) {
      options = void 0;
    }
    if (options && options.klass !== Opal.Hash) {
      keys = (function() {
        var _results;
        _results = [];
        for (key in options) {
          value = options[key];
          _results.push(key);
        }
        return _results;
      })();
      options = Opal.hash2(keys, options);
    }
    return Opal.Opal.$compile(ruby, options);
  };

  for (_i = 0, _len = extensions.length; _i < _len; _i++) {
    extension = extensions[_i];
    require.extensions[extension] = function(module, filename) {
      var ruby;
      ruby = fs.readFileSync("" + filename).toString();
      source = Opal.compile(ruby, {
        file: filename
      });
      return module._compile(source, filename);
    };
  }

  require('./opal_node');

  require('./file');

  require('./dir');

}).call(this);
